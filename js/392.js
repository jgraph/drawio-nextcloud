"use strict";(self.webpackChunkdrawio=self.webpackChunkdrawio||[]).push([[392],{7485(e,t,i){i.d(t,{F:()=>n});var r=i(1222);function n(){try{return(0,r.C)("core","capabilities")}catch(e){return console.debug("Could not find capabilities initial state fall back to _oc_capabilities"),"_oc_capabilities"in window?window._oc_capabilities:{}}}},240(e,t,i){i.d(t,{_:()=>r});const r=(e,t)=>{const i=e.__vccOpts||e;for(const[e,r]of t)i[e]=r;return i}},970(e,t,i){i.d(t,{F:()=>a,P:()=>c,a:()=>h,b:()=>p,c:()=>d,l:()=>s,s:()=>o});var r=i(5947),n=i(1225);window._nc_files_scope??={},window._nc_files_scope.v4_0??={};const o=window._nc_files_scope.v4_0,s=(0,r.YK)().setApp("@nextcloud/files").detectUser().build(),a=Object.freeze({Folder:"folder",File:"file"}),c=Object.freeze({NONE:0,READ:1,UPDATE:2,CREATE:4,WRITE:4,DELETE:8,SHARE:16,ALL:31}),d=Object.freeze({NEW:"new",FAILED:"failed",LOADING:"loading",LOCKED:"locked"});function l(e,t){return null!==e.match(t)}function u(e,t){if(e.id&&"number"!=typeof e.id&&"string"!=typeof e.id)throw new Error("Invalid id type of value");if(!e.source)throw new Error("Missing mandatory source");try{new URL(e.source)}catch{throw new Error("Invalid source format, source must be a valid URL")}if(!e.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(!e.root)throw new Error("Missing mandatory root");if("string"!=typeof e.root)throw new Error("Invalid root type");if(!e.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(!e.source.includes(e.root))throw new Error("Root must be part of the source");if(l(e.source,t)){const i=e.source.match(t)[0];if(!e.source.includes((0,n.fj)(i,e.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(e.displayname&&"string"!=typeof e.displayname)throw new Error("Invalid displayname type");if(e.mtime&&!(e.mtime instanceof Date))throw new Error("Invalid mtime type");if(e.crtime&&!(e.crtime instanceof Date))throw new Error("Invalid crtime type");if(!e.mime||"string"!=typeof e.mime||!e.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in e&&"number"!=typeof e.size&&void 0!==e.size)throw new Error("Invalid size type");if("permissions"in e&&void 0!==e.permissions&&!("number"==typeof e.permissions&&e.permissions>=c.NONE&&e.permissions<=c.ALL))throw new Error("Invalid permissions");if(e.owner&&null!==e.owner&&"string"!=typeof e.owner)throw new Error("Invalid owner type");if(e.attributes&&"object"!=typeof e.attributes)throw new Error("Invalid attributes type");if(e.status&&!Object.values(d).includes(e.status))throw new Error("Status must be a valid NodeStatus")}class f{_attributes;_data;_knownDavService=/(remote|public)\.php\/(web)?dav/i;readonlyAttributes=Object.entries(Object.getOwnPropertyDescriptors(f.prototype)).filter(e=>"function"==typeof e[1].get&&"__proto__"!==e[0]).map(e=>e[0]);handler={set:(e,t,i)=>!this.readonlyAttributes.includes(t)&&Reflect.set(e,t,i),deleteProperty:(e,t)=>!this.readonlyAttributes.includes(t)&&Reflect.deleteProperty(e,t)};constructor(...[e,t]){e.mime||(e.mime="application/octet-stream"),function(e){e.mtime&&"string"==typeof e.mtime&&(isNaN(Date.parse(e.mtime))||JSON.stringify(new Date(e.mtime))!==JSON.stringify(e.mtime)||(e.mtime=new Date(e.mtime))),e.crtime&&"string"==typeof e.crtime&&(isNaN(Date.parse(e.crtime))||JSON.stringify(new Date(e.crtime))!==JSON.stringify(e.crtime)||(e.crtime=new Date(e.crtime)))}(e),u(e,t=function(e){if(e instanceof RegExp)return e;const t=e.match(/(\/?)(.+)\1([a-z]*)/i);if(!t)throw new Error("Invalid regular expression format.");const i=Array.from(new Set(t[3])).filter(e=>"gimsuy".includes(e)).join("");return new RegExp(t[2],i)}(t||this._knownDavService)),this._data={...e,attributes:{}},this._attributes=new Proxy(this._data.attributes,this.handler),this.update(e.attributes??{}),t&&(this._knownDavService=t)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:e}=new URL(this.source);return e+(0,n.O0)(this.source.slice(e.length))}get basename(){return(0,n.P8)(this.source)}get displayname(){return this._data.displayname||this.basename}set displayname(e){u({...this._data,displayname:e},this._knownDavService),this._data.displayname=e}get extension(){return(0,n.LC)(this.source)}get dirname(){return(0,n.pD)(this.path)}get mime(){return this._data.mime||"application/octet-stream"}set mime(e){e??="application/octet-stream",u({...this._data,mime:e},this._knownDavService),this._data.mime=e}get mtime(){return this._data.mtime}set mtime(e){u({...this._data,mtime:e},this._knownDavService),this._data.mtime=e}get crtime(){return this._data.crtime}get size(){return this._data.size}set size(e){u({...this._data,size:e},this._knownDavService),this.updateMtime(),this._data.size=e}get attributes(){return this._attributes}get permissions(){return null!==this.owner||this.isDavResource?void 0!==this._data.permissions?this._data.permissions:c.NONE:c.READ}set permissions(e){u({...this._data,permissions:e},this._knownDavService),this.updateMtime(),this._data.permissions=e}get owner(){return this.isDavResource?this._data.owner:null}get isDavResource(){return l(this.source,this._knownDavService)}get root(){return this._data.root.replace(/^(.+)\/$/,"$1")}get path(){const e=this.source.indexOf("://"),t=this.source.slice(0,e),i=this.source.slice(e+3),r=i.indexOf("/"),o=i.slice(0,r),s=i.slice(r),a=`${t}://${o}${(0,n.O0)(s)}`,c=new URL(a);let d=decodeURIComponent(c.pathname);this.isDavResource&&(d=d.split(this._knownDavService).pop());const l=d.indexOf(this.root),u=this.root.replace(/\/$/,"");return d.slice(l+u.length)||"/"}get fileid(){return"number"==typeof this._data?.id?this._data.id:void 0}get id(){if(!(void 0===this._data?.id||"number"==typeof this._data.id&&this._data.id<0))return String(this._data.id)}get status(){return this._data?.status}set status(e){u({...this._data,status:e},this._knownDavService),this._data.status=e}move(e){u({...this._data,source:e},this._knownDavService);const t=this.basename;this._data.source=e,this.displayname===t&&this.basename!==t&&(this.displayname=this.basename)}rename(e){if(e.includes("/"))throw new Error("Invalid basename");this.move((0,n.pD)(this.source)+"/"+e)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}update(e){for(const[t,i]of Object.entries(e))try{void 0===i?delete this.attributes[t]:this.attributes[t]=i}catch(e){if(e instanceof TypeError)continue;throw e}}clone(){return new this.constructor(structuredClone(this._data),this._knownDavService)}toJSON(){return JSON.stringify([structuredClone(this._data),this._knownDavService.toString()])}}class h extends f{constructor(...[e,t]){super(e,t)}get type(){return a.File}}class p extends f{constructor(...[e,t]){super({...e,mime:"httpd/unix-directory"},t)}get type(){return a.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}}},1379(e,t,i){i.d(t,{m9:()=>c,ZH:()=>r.a,pt:()=>r.F,di:()=>p,nF:()=>h,aX:()=>r.P,zj:()=>f,v7:()=>y,Gg:()=>d,ur:()=>E,KT:()=>m});var r=i(970),n=class extends EventTarget{dispatchTypedEvent(e,t){return super.dispatchEvent(t)}},o=i(7485),s=i(3334);class a extends(792==i.j?n:null){}const c=Object.freeze({DEFAULT:"default",HIDDEN:"hidden"});function d(e){!function(e){if(!e.id||"string"!=typeof e.id)throw new Error("Invalid id");if(!e.displayName||"function"!=typeof e.displayName)throw new Error("Invalid displayName function");if("title"in e&&"function"!=typeof e.title)throw new Error("Invalid title function");if(!e.iconSvgInline||"function"!=typeof e.iconSvgInline)throw new Error("Invalid iconSvgInline function");if(!e.exec||"function"!=typeof e.exec)throw new Error("Invalid exec function");if("enabled"in e&&"function"!=typeof e.enabled)throw new Error("Invalid enabled function");if("execBatch"in e&&"function"!=typeof e.execBatch)throw new Error("Invalid execBatch function");if("order"in e&&"number"!=typeof e.order)throw new Error("Invalid order");if(void 0!==e.destructive&&"boolean"!=typeof e.destructive)throw new Error("Invalid destructive flag");if("parent"in e&&"string"!=typeof e.parent)throw new Error("Invalid parent");if(e.default&&!Object.values(c).includes(e.default))throw new Error("Invalid default");if("inline"in e&&"function"!=typeof e.inline)throw new Error("Invalid inline function");if("renderInline"in e&&"function"!=typeof e.renderInline)throw new Error("Invalid renderInline function");if("hotkey"in e&&void 0!==e.hotkey){if("object"!=typeof e.hotkey)throw new Error("Invalid hotkey configuration");if("string"!=typeof e.hotkey.key||!e.hotkey.key)throw new Error("Missing or invalid hotkey key");if("string"!=typeof e.hotkey.description||!e.hotkey.description)throw new Error("Missing or invalid hotkey description")}}(e),r.s.fileActions??=new Map,r.s.fileActions.has(e.id)?r.l.error(`FileAction ${e.id} already registered`,{action:e}):(r.s.fileActions.set(e.id,e),(r.s.registry??=new a,r.s.registry).dispatchTypedEvent("register:action",new CustomEvent("register:action",{detail:e})))}const l=Object.freeze({UploadFromDevice:0,CreateNew:1,Other:2});class u{_entries=[];registerEntry(e){this.validateEntry(e),e.category=e.category??l.CreateNew,this._entries.push(e)}unregisterEntry(e){const t="string"==typeof e?this.getEntryIndex(e):this.getEntryIndex(e.id);-1!==t?this._entries.splice(t,1):r.l.warn("Entry not found, nothing removed",{entry:e,entries:this.getEntries()})}getEntries(e){return e?this._entries.filter(t=>"function"!=typeof t.enabled||t.enabled(e)):this._entries}getEntryIndex(e){return this._entries.findIndex(t=>t.id===e)}validateEntry(e){if(!(e.id&&e.displayName&&e.iconSvgInline&&e.handler))throw new Error("Invalid entry");if("string"!=typeof e.id||"string"!=typeof e.displayName)throw new Error("Invalid id or displayName property");if(e.iconSvgInline&&"string"!=typeof e.iconSvgInline)throw new Error("Invalid icon provided");if(void 0!==e.enabled&&"function"!=typeof e.enabled)throw new Error("Invalid enabled property");if("function"!=typeof e.handler)throw new Error("Invalid handler property");if("order"in e&&"number"!=typeof e.order)throw new Error("Invalid order property");if(-1!==this.getEntryIndex(e.id))throw new Error("Duplicate entry")}}function f(e){return(r.s.newFileMenu??=new u,r.s.newFileMenu).registerEntry(e)}const h=Object.freeze({ReservedName:"reserved name",Character:"character",Extension:"extension"});class p extends Error{constructor(e){super(`Invalid ${e.reason} '${e.segment}' in filename '${e.filename}'`,{cause:e})}get filename(){return this.cause.filename}get reason(){return this.cause.reason}get segment(){return this.cause.segment}}function m(e){const t=(0,o.F)().files,i=t.forbidden_filename_characters??["/","\\"];for(const t of i)if(e.includes(t))throw new p({segment:t,reason:h.Character,filename:e});if(e=e.toLocaleLowerCase(),(t.forbidden_filenames??[".htaccess"]).includes(e))throw new p({filename:e,segment:e,reason:h.ReservedName});const r=e.indexOf(".",1),n=e.substring(0,-1===r?void 0:r);if((t.forbidden_filename_basenames??[]).includes(n))throw new p({filename:e,segment:n,reason:h.ReservedName});const s=t.forbidden_filename_extensions??[];for(const t of s)if(e.length>t.length&&e.endsWith(t))throw new p({segment:t,reason:h.Extension,filename:e})}const w=["B","KB","MB","GB","TB","PB"],g=["B","KiB","MiB","GiB","TiB","PiB"];function y(e,t=!1,i=!1,r=!1){i=i&&!r,"string"==typeof e&&(e=Number(e));let n=e>0?Math.floor(Math.log(e)/Math.log(r?1e3:1024)):0;n=Math.min((i?g.length:w.length)-1,n);const o=i?g[n]:w[n];let a=(e/Math.pow(r?1e3:1024,n)).toFixed(1);return!0===t&&0===n?("0.0"!==a?"< 1 ":"0 ")+(i?g[1]:w[1]):(a=n<2?parseFloat(a).toFixed(0):parseFloat(a).toLocaleString((0,s.lO)()),a+" "+o)}function v(e){return e instanceof Date?e.toISOString():String(e)}const _=Object.freeze({Name:"basename",Modified:"mtime",Size:"size"});function E(e,t={}){const i={sortingMode:_.Name,sortingOrder:"asc",...t};return function(e,t,i){i=i??[];const r=(t=t??[e=>e]).map((e,t)=>"asc"===(i[t]??"asc")?1:-1),n=Intl.Collator([(0,s.Z0)(),(0,s.lO)()],{numeric:!0,usage:"sort"});return[...e].sort((e,i)=>{for(const[o,s]of t.entries()){const t=n.compare(v(s(e)),v(s(i)));if(0!==t)return t*r[o]}return 0})}(e,[...i.sortFavoritesFirst?[e=>1!==e.attributes?.favorite]:[],...i.sortFoldersFirst?[e=>"folder"!==e.type]:[],...i.sortingMode!==_.Name?[e=>e[i.sortingMode]??e.attributes[i.sortingMode]]:[],e=>function(e){const t=e.displayname||e.attributes?.displayname||e.basename||"";return e.type===r.F.Folder?t:t.lastIndexOf(".")>0?t.slice(0,t.lastIndexOf(".")):t}(e),e=>e.basename],[...i.sortFavoritesFirst?["asc"]:[],...i.sortFoldersFirst?["asc"]:[],...i.sortingMode===_.Modified?["asc"===i.sortingOrder?"desc":"asc"]:[],...i.sortingMode!==_.Modified&&i.sortingMode!==_.Name?[i.sortingOrder]:[],i.sortingOrder,i.sortingOrder])}},1222(e,t,i){function r(e,t,i){const r=`#initial-state-${e}-${t}`;if(window._nc_initial_state?.has(r))return window._nc_initial_state.get(r);window._nc_initial_state||(window._nc_initial_state=new Map);const n=document.querySelector(r);if(null===n){if(void 0!==i)return i;throw new Error(`Could not find initial state ${t} of ${e}`)}try{const e=JSON.parse(atob(n.value));return window._nc_initial_state.set(r,e),e}catch(r){if(console.error("[@nextcloud/initial-state] Could not parse initial state",{key:t,app:e,error:r}),void 0!==i)return i;throw new Error(`Could not parse initial state ${t} of ${e}`,{cause:r})}}i.d(t,{C:()=>r})},1225(e,t,i){function r(e){return e?e.split("/").map(encodeURIComponent).join("/"):e}function n(e,t){return e=e.replace(/\\/g,"/").replace(/\/+$/g,"").replace(/.*\//,""),t&&t!==e&&e.endsWith(t)?e.substring(0,e.length-t.length):e}function o(e){const t=(e=e.replaceAll(/\\/g,"/")).split("/");return t.length<=1?".":(t.pop(),1===t.length&&""===t[0]?"/":t.join("/"))}function s(e){const t=n(e),i=t.lastIndexOf(".");return i>0?t.substring(i):""}function a(...e){if(arguments.length<1)return"";const t=e.filter(e=>e.length>0);if(t.length<1)return"";const i=t[t.length-1],r="/"===t[0].charAt(0),n="/"===i.charAt(i.length-1),o=t.reduce((e,t)=>e.concat(t.split("/")),[]);let s=!r;const a=o.reduce((e,t)=>""===t?e:s?(s=!1,e+t):e+"/"+t,"");return n?a+"/":a}i.d(t,{LC:()=>s,O0:()=>r,P8:()=>n,fj:()=>a,pD:()=>o})}}]);